!function(){"use strict";!function(){angular.module("govright.platformServices",["govright.corpusServices","ui.router","gettext","ngMaterial"])}(),function(){function e(e,t,r,o,n,a){var i,c,s=!1,l={currentUser:void 0,initSocialHandler:function(){s||(e.processAuthMessage=e.processAuthMessage||function(e){return e=JSON.parse(e),e&&e.corpusAccessToken?e.corpusAccessToken.id?e.facebookAccessData&&e.facebookAccessData.appId?(o.setUser(e.corpusAccessToken.id,e.corpusAccessToken.userId),o.rememberMe=!0,o.save(),a.saveAccessData(e.facebookAccessData,o.rememberMe),a.init(),l.setCurrentUser(e),r.$broadcast("auth:login"),void(i&&i.resolve(e))):(console.error("LL Auth: malformed facebook data."),l.clearState(),void(i&&i.reject("malformed-facebook-data"))):(console.error("LL Auth: missing access token."),l.clearState(),void(i&&i.reject("malformed-access-token"))):(console.error("LL Auth: invalid payload."),l.clearState(),void(i&&i.reject("invalid-payload")))},s=!0)},setCurrentUser:function(e){return e.ttl&&e.user&&e.userId?l.currentUser={id:e.userId,facebookAccessData:{},profile:e.user.profile,settings:e.user.settings,email:e.user.email}:l.currentUser={id:e.corpusAccessToken.userId,facebookAccessData:e.facebookAccessData,profile:e.userProfile,settings:e.settings,email:e.email},l.currentUser},login:function(e,t){var o;"object"==typeof e?(o=e.username||e.email,t=e.password):o=e;var a={password:t};return e.email||/\S+@\S+\.\S+/.test(o)?a.email=o:a.username=o,n.login(a,function(e){l.setCurrentUser(e),r.$broadcast("auth:login")},function(e){l.clearState(),console.error("LL Auth: LB user login failed.",e)}).$promise},socialLogin:function(r){if(l.initSocialHandler(),i&&(console.warn("LL Auth: login() called during pending login..."),c&&!c.closed))return c.focus(),i.promise;var o=screen.width/2-350,n=screen.height/2-300;return c=e.open(r,"_blank","toolbar=no,location=no,directories=no,status=no,menubar=no,scrollbars=no,resizable=no,copyhistory=no,width=580,height=400,top="+n+",left="+o),i=t.defer(),i.promise["finally"](function(){c=i=null}),i.promise},checkLogin:function(){return n.isAuthenticated()?n.getCurrent(function(e){l.currentUser={id:e.id,profile:e.profile,facebookAccessData:a.loadAccessData(),settings:e.settings,email:e.email},a.init(),r.$broadcast("auth:login")},function(e){console.error("LL Auth: session restore failed.",e),l.clearState()}).$promise:t(function(e,t){l.clearState(),t(new Error("Session data is missing or expired."))})},clearState:function(){o.clearUser(),o.clearStorage(),a.clearStorage(),l.currentUser=null},logout:function(){var e=function(){l.clearState(),r.$broadcast("auth:logout")};return n.logout().$promise.then(e)["catch"](function(t){console.error("LL Auth: logout error.",t),e()})}};return l}angular.module("govright.platformServices").factory("grAuth",e),e.$inject=["$window","$q","$rootScope","LoopBackAuth","User","grFacebook"]}(),function(){angular.module("govright.platformServices").provider("grEmbeddingParams",["$injector",function(e){var t,r,o=e.get("$rootElementProvider");this.setAppRoot=function(e){r=e.$get?e.$get():e},this.getParams=function(){if(r||this.setAppRoot(o),r=angular.element(r)[0],!t&&(t={isEmbeddedMode:"HTML"!==r.tagName},t.isEmbeddedMode&&[].forEach.call(r.attributes,function(e){if(/^data-/.test(e.name)){var r=e.name.replace("data-","").replace(/-[a-z]/g,function(e){return e[1].toUpperCase()});t[r]=e.value}}),t.query))if(0===t.query.indexOf("{")||0===t.query.indexOf("["))t.query=JSON.parse(t.query);else{var e=t.query.split("&");t.query={},e.forEach(function(e){var r=e.split("=");t.query[r[0]]=r[1]})}return t},this.$get=this.getParams}])}(),function(){function e(e,t){function r(e){return t.FB&&t.FB.init?(g=s(),e=e||{},e.appId=e.appId||n(),e.cookie=!1,e.xfbml=e.xfbml||!0,e.version=e.version||"v2.3",t.FB.init(e)):void console.error("LL Facebook: missing Facebook SDK.")}function o(r,o){return e(function(e,n){var c=a(),s=i();return c?s?(o.access_token=s,null==o["fb:explicitly_shared"]&&(o["fb:explicitly_shared"]=!0),void t.FB.api("me/"+c+":"+r,"post",o,function(t){return console.debug(t),t.error?n("LL Facebook: "+t.error.message):e(t)})):(console.error("LL Facebook: missing Facebook access token."),n("missing-access-token")):(console.error("LL Facebook: missing app namespace."),n("missing-app-namespace"))})}function n(){return g.appId||null}function a(){return g.namespace||null}function i(){return g.accessToken||null}function c(e,t){l();var r=t?localStorage:sessionStorage;u.forEach(function(t){r[f+t]=e[t]})}function s(){return g.appId||u.forEach(function(e){var t=f+e;g[e]=localStorage[t]||sessionStorage[t]||null}),g}function l(){g={},u.forEach(function(e){var t=f+e;localStorage[t]=null,sessionStorage[t]=null})}var u=["accessToken","appId","namespace"],f="$Facebook$",g={};return{init:r,postAction:o,getAppId:n,getNamespace:a,getAccessToken:i,saveAccessData:c,loadAccessData:s,clearStorage:l}}angular.module("govright.platformServices").factory("grFacebook",e),e.$inject=["$q","$window"]}(),function(){function e(e,t){function r(e,t,r){return this.code=e,this.name=t,this.dir=r,this}function o(r){var o=r.code;return r.code=t.getCurrentLanguage(),r.name=t.getString("locale.name"),r.dir=t.getString("locale.direction"),o!==r.code&&e.$broadcast("locale:changed",r),r}var n=null;return{localeList:[],current:o(new r),setCurrent:function(e){return t.setCurrentLanguage(e),o(this.current)},setDefault:function(e){n=e},getString:function(){return t.getString.apply(t,arguments)},lookupString:function(e,r,o,n){var a=t.strings[e]||{},i=a[r]||{},c=i[n||"$$noContext"]||[];return c[o||0]},locales:function(){return this.localeList.length?this.localeList:Object.keys(t.strings).sort().map(function(e){var t=new r(e);return t.name=this.lookupString(e,"locale.name"),t.dir=this.lookupString(e,"locale.direction"),t},this)},isValid:function(e){return e&&t.strings.hasOwnProperty(e)},extract:function(e){if(!e||!e.locales)return{};var t=this.current.code;return e.locales[t]||(t=n),e.locales[t]},property:function(e,t,r){var o=this.determineLocaleCode(e,this.current.code,r);return o?e.locales[o][t]:null},localeDir:function(e,t){var r=this.determineLocaleCode(e,this.current.code,t);return r?this.lookupString(r,"locale.direction"):null},setLocales:function(o){var n=[];return Object.keys(t.strings).sort().map(function(e){if(o.indexOf(e)>-1){var t=new r(e);t.name=this.lookupString(e,"locale.name"),t.dir=this.lookupString(e,"locale.direction"),n.push(t)}},this),this.localeList=n,e.$broadcast("locale:new-list"),n},determineLocaleCode:function(e,t,r){if(!e||!e.locales)return null;if(e.locales[t])return t;if(e.defaultLocale&&e.locales[e.defaultLocale])return e.defaultLocale;var o=n;return r&&!e.locales[o]&&(o=Object.keys(e.locales).shift()),e.locales[o]?o:null}}}angular.module("govright.platformServices").factory("grLocale",e),e.$inject=["$rootScope","gettextCatalog"]}(),function(){function e(e,t,r){return{error404:function(e){r.transitionTo("site.404",{message:e},{location:!1,inherit:!0})},transition:function(e,t){r.transitionTo("site.message",{title:e,message:t},{location:!1,inherit:!0})},success:function(t){e.show(e.simple().content(t||"Action successfully complete").position("bottom right").hideDelay(3e3))},error:function(e,r,o){var n;n="object"==typeof r?r.data&&r.data.error&&r.data.error.message?r.data.error.message:r.message||"":r||"",t.show(t.alert().clickOutsideToClose(!0).title(e).content(n).ok(o||"Close"))},confirm:function(e,r,o){var n=t.confirm().title(e||"Are you sure?").targetEvent().ok(r||"Ok").cancel(o||"Cancel");return t.show(n)}}}angular.module("govright.platformServices").factory("grMessage",["$mdToast","$mdDialog","$state",e])}(),function(){function e(e,t){function r(r,n){function a(e,r){e.nodes.forEach(function(o){s.push(o),c[o.id]=o,o.parent=e,o.depth=r,o.title=l.nodeTitle(o),o.href=l.nodeHref(o),i.populateNodeText&&(o.text=t.property(o.original,"text",!0)||""),a(o,r+1)})}var i=angular.extend({},o,n),c={},s=[],l=this;this.findById=function(e){return c[e]},this.nodeTitle=function(e){var t=i.nodeTitleResolver(e,r);return t&&i.maxTitleLength&&t.length>i.maxTitleLength&&(t=t.substring(0,i.maxTitleLength-1)+"â€¦"),t},this.nodeHref=function(e){return i.nodeHrefResolver(e,r)},this.openNodeParents=function(e){e&&e.parent&&e.parent.original&&(e.parent.open||(e.parent.open=!0),this.openNodeParents(e.parent))},this.getFlatList=function(){return s},a(r,0);var u=null;s.forEach(function(e){e["abstract"]||(e.prev=u,e.next=null,u&&(u.next=e),u=e)}),i.repopulateOnLocaleChange&&e.$on("locale:changed",function(){s.forEach(function(e){e.title=l.nodeTitle(e),e.href=l.nodeHref(e),i.populateNodeText&&(e.text=t.property(e.original,"text",!0)||"")})})}var o={maxTitleLength:0,populateNodeText:!0,repopulateOnLocaleChange:!0,nodeTitleResolver:function(e){return t.property(e.original,"title")},nodeHrefResolver:function(e){return"http://corpus.govright.org/api/Nodes/"+e.id+"?filter[include][original]"}};return{create:function(e,t){return new r(e,t)}}}angular.module("govright.platformServices").factory("grNodeTree",e),e.$inject=["$rootScope","grLocale"]}()}();