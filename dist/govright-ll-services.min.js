!function(){"use strict";!function(){angular.module("govright.llServices",["govright.corpusServices","ui.router","gettext"])}(),function(){function e(e,o,t,r,n,a){var s,c,i=!1,l={currentUser:void 0,initSocialHandler:function(){i||(e.processAuthMessage=e.processAuthMessage||function(e){return e=JSON.parse(e),e&&e.corpusAccessToken?e.corpusAccessToken.id?e.facebookAccessData&&e.facebookAccessData.appId?(r.setUser(e.corpusAccessToken.id,e.corpusAccessToken.userId),r.rememberMe=!0,r.save(),a.saveAccessData(e.facebookAccessData,r.rememberMe),a.init(),l.setCurrentUser(e),t.$broadcast("auth:login"),void(s&&s.resolve(e))):(console.error("LL Auth: malformed facebook data."),l.clearState(),void(s&&s.reject("malformed-facebook-data"))):(console.error("LL Auth: missing access token."),l.clearState(),void(s&&s.reject("malformed-access-token"))):(console.error("LL Auth: invalid payload."),l.clearState(),void(s&&s.reject("invalid-payload")))},i=!0)},setCurrentUser:function(e){return e.ttl&&e.user&&e.userId?l.currentUser={id:e.userId,facebookAccessData:{},profile:e.user.profile,settings:e.user.settings,email:e.user.email}:l.currentUser={id:e.corpusAccessToken.userId,facebookAccessData:e.facebookAccessData,profile:e.userProfile,settings:e.settings,email:e.email},l.currentUser},login:function(e,o){var r;"object"==typeof e?(r=e.username||e.email,o=e.password):r=e;var a={password:o};return e.email||/\S+@\S+\.\S+/.test(r)?a.email=r:a.username=r,n.login(a,function(e){l.setCurrentUser(e),t.$broadcast("auth:login")},function(e){l.clearState(),console.error("LL Auth: LB user login failed.",e)}).$promise},socialLogin:function(t){if(l.initSocialHandler(),s&&(console.warn("LL Auth: login() called during pending login..."),c&&!c.closed))return c.focus(),s.promise;var r=screen.width/2-350,n=screen.height/2-300;return c=e.open(t,"_blank","toolbar=no,location=no,directories=no,status=no,menubar=no,scrollbars=no,resizable=no,copyhistory=no,width=580,height=400,top="+n+",left="+r),s=o.defer(),s.promise["finally"](function(){c=s=null}),s.promise},checkLogin:function(){return n.isAuthenticated()?n.getCurrent(function(e){l.currentUser={id:e.id,profile:e.profile,facebookAccessData:a.loadAccessData(),settings:e.settings,email:e.email},a.init(),t.$broadcast("auth:login")},function(e){console.error("LL Auth: session restore failed.",e),l.clearState()}).$promise:o(function(e,o){l.clearState(),o(new Error("Session data is missing or expired."))})},clearState:function(){r.clearUser(),r.clearStorage(),a.clearStorage(),l.currentUser=null},logout:function(){var e=function(){l.clearState(),t.$broadcast("auth:logout")};return n.logout().$promise.then(e)["catch"](function(o){console.error("LL Auth: logout error.",o),e()})}};return l}angular.module("govright.llServices").factory("llAuth",e),e.$inject=["$window","$q","$rootScope","LoopBackAuth","User","llFacebook"]}(),function(){function e(e,o){function t(e){return o.FB&&o.FB.init?(g=i(),e=e||{},e.appId=e.appId||n(),e.cookie=!1,e.xfbml=e.xfbml||!0,e.version=e.version||"v2.3",o.FB.init(e)):void console.error("LL Facebook: missing Facebook SDK.")}function r(t,r){return e(function(e,n){var c=a(),i=s();return c?i?(r.access_token=i,null==r["fb:explicitly_shared"]&&(r["fb:explicitly_shared"]=!0),void o.FB.api("me/"+c+":"+t,"post",r,function(o){return console.debug(o),o.error?n("LL Facebook: "+o.error.message):e(o)})):(console.error("LL Facebook: missing Facebook access token."),n("missing-access-token")):(console.error("LL Facebook: missing app namespace."),n("missing-app-namespace"))})}function n(){return g.appId||null}function a(){return g.namespace||null}function s(){return g.accessToken||null}function c(e,o){l();var t=o?localStorage:sessionStorage;u.forEach(function(o){t[f+o]=e[o]})}function i(){return g.appId||u.forEach(function(e){var o=f+e;g[e]=localStorage[o]||sessionStorage[o]||null}),g}function l(){g={},u.forEach(function(e){var o=f+e;localStorage[o]=null,sessionStorage[o]=null})}var u=["accessToken","appId","namespace"],f="$Facebook$",g={};return{init:t,postAction:r,getAppId:n,getNamespace:a,getAccessToken:s,saveAccessData:c,loadAccessData:i,clearStorage:l}}angular.module("govright.llServices").factory("llFacebook",e),e.$inject=["$q","$window"]}(),function(){function e(e,o){function t(e,o,t){return this.code=e,this.name=o,this.dir=t,this}function r(t){var r=t.code;return t.code=o.getCurrentLanguage(),t.name=o.getString("locale.name"),t.dir=o.getString("locale.direction"),r!==t.code&&e.$broadcast("locale:changed",t),t}var n=null;return{localeList:[],current:r(new t),setCurrent:function(e){return o.setCurrentLanguage(e),r(this.current)},setDefault:function(e){n=e},getString:function(){return o.getString.apply(o,arguments)},lookupString:function(e,t,r,n){var a=o.strings[e]||{},s=a[t]||{},c=s[n||"$$noContext"]||[];return c[r||0]},locales:function(){return this.localeList.length?this.localeList:Object.keys(o.strings).sort().map(function(e){var o=new t(e);return o.name=this.lookupString(e,"locale.name"),o.dir=this.lookupString(e,"locale.direction"),o},this)},isValid:function(e){return e&&o.strings.hasOwnProperty(e)},extract:function(e){if(!e||!e.locales)return{};var o=this.current.code;return e.locales[o]||(o=n),e.locales[o]},property:function(e,o,t){var r=this.determineLocaleCode(e,this.current.code,t);return r?e.locales[r][o]:null},localeDir:function(e,o){var t=this.determineLocaleCode(e,this.current.code,o);return t?this.lookupString(t,"locale.direction"):null},setLocales:function(r){var n=[];return Object.keys(o.strings).sort().map(function(e){if(r.indexOf(e)>-1){var o=new t(e);o.name=this.lookupString(e,"locale.name"),o.dir=this.lookupString(e,"locale.direction"),n.push(o)}},this),this.localeList=n,e.$broadcast("locale:new-list"),n},determineLocaleCode:function(e,o,t){if(!e||!e.locales)return null;if(e.locales[o])return o;if(e.defaultLocale&&e.locales[e.defaultLocale])return e.defaultLocale;var r=n;return t&&!e.locales[r]&&(r=Object.keys(e.locales).shift()),e.locales[r]?r:null}}}angular.module("govright.llServices").factory("llLocale",e),e.$inject=["$rootScope","gettextCatalog"]}(),function(){function e(e,o,t){return{error404:function(e){t.transitionTo("site.404",{message:e},{location:!1,inherit:!0})},transition:function(e,o){t.transitionTo("site.message",{title:e,message:o},{location:!1,inherit:!0})},success:function(o){e.show(e.simple().content(o||"Action successfully complete").position("bottom right").hideDelay(3e3))},error:function(e,t,r){var n;n="object"==typeof t?t.data&&t.data.error&&t.data.error.message?t.data.error.message:t.message||"":t||"",o.show(o.alert().clickOutsideToClose(!0).title(e).content(n).ok(r||"Close"))},confirm:function(e,t,r){var n=o.confirm().title(e||"Are you sure?").targetEvent().ok(t||"Ok").cancel(r||"Cancel");return o.show(n)}}}angular.module("govright.llServices").factory("llMessage",["$mdToast","$mdDialog","$state",e])}()}();